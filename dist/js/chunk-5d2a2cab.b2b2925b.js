(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d2a2cab"],{"1d1c":function(t,e,l){"use strict";l.r(e);var a=function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("meta",{attrs:{name:"referrer",content:"no-referrer"}}),l("div",{staticStyle:{"margin-left":"100px","margin-top":"50px"}},[l("el-page-header",{attrs:{content:"编辑页面"},on:{back:function(e){return t.close()}}})],1),l("h1",{staticStyle:{"text-align":"center","margin-top":"50px","font-family":"'arial, helvetica, sans-serif'"}},[t._v("走访详情")]),l("div",{staticStyle:{margin:"20px"}}),l("el-form",{staticStyle:{"margin-left":"150px","margin-right":"150px","margin-top":"50px"},attrs:{"label-position":t.labelPosition,"label-width":"80px",model:t.formLabelAlign}},[l("el-form-item",{staticClass:"form-item",attrs:{prop:"volunteer"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-user"}),l("span",[t._v(" 志愿者： ")])])]),l("el-input",{attrs:{placeholder:" * 必填项 "},model:{value:t.formLabelAlign.volunteer,callback:function(e){t.$set(t.formLabelAlign,"volunteer",e)},expression:"formLabelAlign.volunteer"}})],1),l("el-form-item",{staticClass:"form-item",attrs:{prop:"date"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-time"}),l("span",[t._v(" 走访时间： ")])])]),l("el-input",{attrs:{placeholder:" * 必填项（格式为yyyy-mm-dd）"},model:{value:t.formLabelAlign.date,callback:function(e){t.$set(t.formLabelAlign,"date",e)},expression:"formLabelAlign.date"}})],1),l("el-form-item",{staticClass:"form-item",attrs:{prop:"host"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-key"}),l("span",[t._v(" 户主： ")])])]),l("el-input",{attrs:{placeholder:" * 必填项 "},model:{value:t.formLabelAlign.host,callback:function(e){t.$set(t.formLabelAlign,"host",e)},expression:"formLabelAlign.host"}})],1),l("el-form-item",{staticClass:"form-item",attrs:{prop:"location"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-location"}),l("span",[t._v(" 行政区域： ")])])]),l("el-input",{attrs:{placeholder:" * 必填项 "},model:{value:t.formLabelAlign.location,callback:function(e){t.$set(t.formLabelAlign,"location",e)},expression:"formLabelAlign.location"}})],1),l("el-form-item",{staticClass:"form-item",attrs:{prop:"type"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-connection"}),l("span",[t._v(" 走访类型： ")])])]),l("el-input",{attrs:{placeholder:" * 必填项 "},model:{value:t.formLabelAlign.type,callback:function(e){t.$set(t.formLabelAlign,"type",e)},expression:"formLabelAlign.type"}})],1),l("el-form-item",{staticClass:"form-item",attrs:{prop:"famType"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-s-home"}),l("span",[t._v(" 家庭类型： ")])])]),l("el-input",{attrs:{placeholder:" * 必填项 "},model:{value:t.formLabelAlign.famType,callback:function(e){t.$set(t.formLabelAlign,"famType",e)},expression:"formLabelAlign.famType"}})],1),l("el-form-item",{staticClass:"form-item",attrs:{prop:"content"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-chat-line-round"}),l("span",[t._v(" 走访内容： ")])])]),l("el-input",{attrs:{type:"textarea",autosize:""},model:{value:t.formLabelAlign.content,callback:function(e){t.$set(t.formLabelAlign,"content",e)},expression:"formLabelAlign.content"}})],1),l("el-form-item",{staticClass:"form-item",attrs:{prop:"urls"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-camera"}),l("span",[t._v(" 走访照片： ")])])]),l("div",{staticStyle:{"margin-top":"20px","margin-bottom":"40px"},attrs:{align:"center"}},[l("el-popover",{attrs:{placement:"top-start",title:"提示:",trigger:"hover",content:"点击单张图片可以进行删除操作；误选请刷新页面以撤销操作。"}},[l("el-button",{attrs:{slot:"reference",circle:"",type:"info",icon:"el-icon-bell"},slot:"reference"})],1)],1),l("div",{staticClass:"demo-image__lazy",staticStyle:{width:"80%","text-align":"center",margin:"0 auto","align-items":"center","justify-content":"center","vertical-align":"middle"}},t._l(this.urls,(function(e){return l("el-image",{key:e,attrs:{src:e,lazy:"",title:"走访图片(点击可以进行删除操作)"},on:{click:function(l){return t.editPhoto(e)}}},[l("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[l("i",{staticClass:"el-icon-loading"}),t._v("加载中 ")]),l("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[l("i",{staticClass:"el-icon-picture-outline"})])])})),1)]),l("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.showDelete,expression:"showDelete"}],staticClass:"form-item",attrs:{prop:"deletePhoto"}},[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"span-box"},[l("i",{staticClass:"el-icon-delete"}),l("span",[t._v(" 照片回收站： ")])])]),l("div",{staticClass:"demo-image__lazy",staticStyle:{width:"40%",display:"flex","text-align":"center","vertical-align":"middle","justify-content":"center","align-items":"center",margin:"0 auto","margin-top":"40px"}},t._l(this.formLabelAlign.deletePhoto_list,(function(e){return l("el-image",{key:e,attrs:{src:e,lazy:"",title:"删除队列"}},[l("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[l("i",{staticClass:"el-icon-loading"}),t._v("加载中 ")]),l("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[l("i",{staticClass:"el-icon-picture-outline"})])])})),1)])],1),l("div",{directives:[{name:"show",rawName:"v-show",value:t.showDelete,expression:"showDelete"}],staticStyle:{"margin-top":"40px"},attrs:{align:"center"}},[l("el-popover",{attrs:{placement:"top-start",title:"照片回收站:",trigger:"hover",content:"恢复全部。"}},[l("el-button",{attrs:{slot:"reference",circle:"",type:"primary",icon:"el-icon-refresh-left"},nativeOn:{click:function(e){return t.refresh()}},slot:"reference"})],1)],1),l("el-upload",{staticClass:"upload-demo",staticStyle:{"text-align":"center","margin-top":"80px","margin-bottom":"10px"},attrs:{drag:"","auto-upload":!1,action:"#",multiple:"","on-change":t.handleChange,"on-remove":t.handleRemove,"file-list":t.fileList}},[l("i",{staticClass:"el-icon-upload"}),l("div",{staticClass:"el-upload__text"},[t._v("若要添加照片，将其拖到此处，或"),l("em",[t._v("点击上传")])]),l("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/jpeg/png文件，且不超过10MB")])]),l("el-backtop"),l("div",{staticStyle:{"margin-bottom":"100px","margin-top":"60px"},attrs:{align:"center"}},[l("el-popover",{attrs:{placement:"top-start",title:"提示:",trigger:"hover",content:'点击"提交"按钮可以保存更改。'}},[l("el-button",{attrs:{slot:"reference",type:"danger",disabled:t.submitDisa},nativeOn:{click:function(e){return t.submit()}},slot:"reference"},[t._v("提交")])],1),l("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"success"},nativeOn:{click:function(e){return t.close()}}},[t._v("返回")])],1)],1)},s=[],i=(l("20d6"),l("ac6a"),l("f3e2"),l("7f7f"),l("b775"));function o(t){return Object(i["a"])({url:"/edit",method:"POST",data:t})}var n=l("852e"),r=l.n(n),c={data:function(){return{showDelete:!1,submitDisa:!1,fileList:[],labelPosition:"top",urls:[],formLabelAlign:{id:"",role:"",volunteer:"",date:"",host:"",famType:"",content:"",deletePhoto_list:[],location:"",type:"",file:new FormData}}},created:function(){var t=r.a.get("role");"villager"===t&&(this.submitDisa=!0),t=null;var e=JSON.parse(sessionStorage.getItem("detail"));this.formLabelAlign.volunteer=e.volunteer,this.formLabelAlign.date=e.detail.date,this.formLabelAlign.host=e.villager,this.formLabelAlign.famType=e.detail.famType,this.formLabelAlign.content=e.detail.content,this.urls=e.detail.photo,this.formLabelAlign.location=e.district,this.formLabelAlign.type=e.type,this.formLabelAlign.id=sessionStorage.getItem("username"),this.formLabelAlign.role=sessionStorage.getItem("role"),e=null},beforeRouteLeave:function(t,e,l){this.urls=[],this.formLabelAlign={},this.fileList=[],sessionStorage.setItem("detail",""),l()},methods:{handleChange:function(t,e){var l=t.raw.name,a=!0,s=0;e.forEach((function(t,e){t.name===l&&s++})),a=1===s;var i="image/jpeg"===t.raw.type||"image/jpg"===t.raw.type,o="image/png"===t.raw.type,n=i||o,r=t.raw.size/1024/1024<10;return n?r?a?!!(n&&r&&a)&&(this.fileList=e,!0):(e.length>0&&e.splice(e.length-1,1),this.$message.error("文件名称重复！"),!1):(e.length>0&&e.splice(e.length-1,1),this.$message.error("图片大小不能超过 10MB !"),!1):(e.length>0&&e.splice(e.length-1,1),this.$message.error("图片只能是 JPG/JPEG 或 PNG 格式!"),!1)},handleRemove:function(t,e){this.fileList=e},close:function(){sessionStorage.setItem("detail",""),this.$router.push("/search")},submit:function(){var t=this;if(""!==this.formLabelAlign.volunteer)if(""!==this.formLabelAlign.date)if(""!==this.formLabelAlign.host)if(""!==this.formLabelAlign.distric)if(""!==this.formLabelAlign.type)if(""!==this.formLabelAlign.famType){var e=JSON.parse(sessionStorage.getItem("detail"));this.formLabelAlign.volunteer!==e.volunteer||this.formLabelAlign.date!==e.detail.date||this.formLabelAlign.host!==e.villager||this.formLabelAlign.famType!==e.detail.famType||this.formLabelAlign.content!==e.detail.content||0!==this.fileList.length||0!==this.formLabelAlign.deletePhoto_list.length||this.formLabelAlign.location!==e.district||this.formLabelAlign.type!==e.type?(e=null,this.fileList.forEach((function(e,l){t.formLabelAlign.file.append("file",e.raw)})),o(this.formLabelAlign).then((function(e){t.$message.success("提交成功，页面即将刷新！"),setTimeout("location.reload()",2e3)})).catch((function(e){t.$message.error("提交失败！")}))):this.$message.error("未作修改！")}else this.$message.error('"家庭类型"信息不能为空！');else this.$message.error('"走访类型"信息不能为空！');else this.$message.error('"行政区域"信息不能为空！');else this.$message.error('"户主"信息不能为空！');else this.$message.error('"走访时间"信息不能为空！');else this.$message.error('"志愿者"信息不能为空！')},editPhoto:function(t){var e=this;this.$confirm("选中的这张照片将被放入回收站，提交后将被删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showDelete=!0;var l=e.urls.findIndex((function(e){return e===t}));e.urls.splice(l,1);var a=!0;e.formLabelAlign.deletePhoto_list.forEach((function(l,s){if(t===l)return e.$message.error("请不要重复添加！"),void(a=!1)})),a&&(e.formLabelAlign.deletePhoto_list.push(t),e.$message({type:"success",message:"已选择"+e.formLabelAlign.deletePhoto_list.length+"张图片，提交后生效！"}))})).catch((function(t){e.$message({type:"info",message:"您取消了操作！"})}))},refresh:function(){var t=this;this.formLabelAlign.deletePhoto_list.forEach((function(e,l){t.urls.push(e)})),this.formLabelAlign.deletePhoto_list=[],this.showDelete=!1}}},m=c,p=(l("abfa"),l("2877")),f=Object(p["a"])(m,a,s,!1,null,null,null);e["default"]=f.exports},"20d6":function(t,e,l){"use strict";var a=l("5ca1"),s=l("0a49")(6),i="findIndex",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),a(a.P+a.F*o,"Array",{findIndex:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),l("9c6c")(i)},"7f7f":function(t,e,l){var a=l("86cc").f,s=Function.prototype,i=/^\s*function ([^ (]*)/,o="name";o in s||l("9e1e")&&a(s,o,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})},"973b":function(t,e,l){},abfa:function(t,e,l){"use strict";l("973b")}}]);
//# sourceMappingURL=chunk-5d2a2cab.b2b2925b.js.map